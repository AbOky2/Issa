{"ast":null,"code":"import _regeneratorRuntime from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Router from 'next/router';\nimport * as NProgress from 'nprogress';\nimport { StudentSidebarComp, AdminSidebarComp } from './AuthWrapper';\nRouter.events.on('routeChangeStart', function () {\n  NProgress.start();\n});\nRouter.events.on('routeChangeComplete', function (url) {\n  if (window && process.env.GA_MEASUREMENT_ID) {\n    window.gtag('config', process.env.GA_MEASUREMENT_ID, {\n      page_path: url\n    });\n  }\n\n  NProgress.done();\n});\nRouter.events.on('routeChangeError', function () {\n  return NProgress.done();\n});\nvar globalUser = null;\nexport default function withAuth(BaseComponent) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$loginRequired = _ref.loginRequired,\n      loginRequired = _ref$loginRequired === void 0 ? true : _ref$loginRequired,\n      _ref$logoutRequired = _ref.logoutRequired,\n      logoutRequired = _ref$logoutRequired === void 0 ? false : _ref$logoutRequired,\n      _ref$adminRequired = _ref.adminRequired,\n      adminRequired = _ref$adminRequired === void 0 ? false : _ref$adminRequired;\n\n  var App = /*#__PURE__*/function (_React$Component) {\n    _inherits(App, _React$Component);\n\n    var _super = _createSuper(App);\n\n    function App() {\n      _classCallCheck(this, App);\n\n      return _super.apply(this, arguments);\n    }\n\n    _createClass(App, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        var _this$props = this.props,\n            user = _this$props.user,\n            isFromServer = _this$props.isFromServer;\n\n        if (isFromServer) {\n          globalUser = user;\n        }\n\n        if (loginRequired && !logoutRequired && !user) {\n          Router.push('/public/login', '/login');\n          return;\n        }\n\n        if (adminRequired && (!user || !user.isAdmin)) {\n          Router.push('/customer/my-books', '/my-books');\n        }\n\n        if (logoutRequired && user) {\n          Router.push('/');\n        }\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var user = this.props.user;\n\n        if (loginRequired && !logoutRequired && !user) {\n          return null;\n        }\n\n        if (adminRequired && (!user || !user.isAdmin)) {\n          return null;\n        }\n\n        if (logoutRequired && user) {\n          return null;\n        }\n\n        if (!user) return __jsx(BaseComponent, this.props);\n        if (user !== null && user !== void 0 && user.isAdmin || (user === null || user === void 0 ? void 0 : user.role) === 'admin') return __jsx(React.Fragment, null, __jsx(AdminSidebarComp, {\n          user: user\n        }, __jsx(BaseComponent, this.props)));\n        return __jsx(React.Fragment, null, __jsx(StudentSidebarComp, {\n          user: user\n        }, __jsx(BaseComponent, this.props)));\n      }\n    }], [{\n      key: \"getInitialProps\",\n      value: function () {\n        var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx) {\n          var isFromServer, user, props;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  isFromServer = false;\n                  user = ctx.req ? ctx.req.user && ctx.req.user : globalUser;\n\n                  if (isFromServer && user) {\n                    user._id = user._id.toString();\n                  }\n\n                  props = {\n                    user: user,\n                    isFromServer: isFromServer\n                  };\n\n                  if (!BaseComponent.getInitialProps) {\n                    _context.next = 14;\n                    break;\n                  }\n\n                  _context.t0 = Object;\n                  _context.t1 = props;\n                  _context.next = 9;\n                  return BaseComponent.getInitialProps(ctx);\n\n                case 9:\n                  _context.t2 = _context.sent;\n\n                  if (_context.t2) {\n                    _context.next = 12;\n                    break;\n                  }\n\n                  _context.t2 = {};\n\n                case 12:\n                  _context.t3 = _context.t2;\n\n                  _context.t0.assign.call(_context.t0, _context.t1, _context.t3);\n\n                case 14:\n                  return _context.abrupt(\"return\", props);\n\n                case 15:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function getInitialProps(_x) {\n          return _getInitialProps.apply(this, arguments);\n        }\n\n        return getInitialProps;\n      }()\n    }]);\n\n    return App;\n  }(React.Component);\n\n  var propTypes = {\n    user: PropTypes.shape({\n      id: PropTypes.string,\n      isAdmin: PropTypes.bool\n    }),\n    isFromServer: PropTypes.bool.isRequired\n  };\n  var defaultProps = {\n    user: null\n  };\n  App.defaultProps = defaultProps;\n  return App;\n}","map":null,"metadata":{},"sourceType":"module"}