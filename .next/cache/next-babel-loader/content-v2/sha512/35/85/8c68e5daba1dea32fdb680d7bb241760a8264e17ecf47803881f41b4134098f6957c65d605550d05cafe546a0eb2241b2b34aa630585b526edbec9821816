{"ast":null,"code":"import _regeneratorRuntime from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _extends from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/extends\";\nimport _classCallCheck from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/usr/src/kit-le-nid/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/usr/src/kit-le-nid/lib/withAuth.jsx\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Router from 'next/router';\nimport * as NProgress from 'nprogress';\nimport { StudentSidebarComp, AdminSidebarComp } from './AuthWrapper';\nRouter.events.on('routeChangeStart', function () {\n  NProgress.start();\n});\nRouter.events.on('routeChangeComplete', function (url) {\n  if (window && process.env.GA_MEASUREMENT_ID) {\n    window.gtag('config', process.env.GA_MEASUREMENT_ID, {\n      page_path: url\n    });\n  }\n\n  NProgress.done();\n});\nRouter.events.on('routeChangeError', function () {\n  return NProgress.done();\n});\nvar globalUser = null;\nexport default function withAuth(BaseComponent) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$loginRequired = _ref.loginRequired,\n      loginRequired = _ref$loginRequired === void 0 ? true : _ref$loginRequired,\n      _ref$logoutRequired = _ref.logoutRequired,\n      logoutRequired = _ref$logoutRequired === void 0 ? false : _ref$logoutRequired,\n      _ref$adminRequired = _ref.adminRequired,\n      adminRequired = _ref$adminRequired === void 0 ? false : _ref$adminRequired;\n\n  var App = /*#__PURE__*/function (_React$Component) {\n    _inherits(App, _React$Component);\n\n    var _super = _createSuper(App);\n\n    function App() {\n      _classCallCheck(this, App);\n\n      return _super.apply(this, arguments);\n    }\n\n    _createClass(App, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        var _this$props = this.props,\n            user = _this$props.user,\n            isFromServer = _this$props.isFromServer;\n\n        if (isFromServer) {\n          globalUser = user;\n        }\n\n        if (loginRequired && !logoutRequired && !user) {\n          Router.push('/public/login', '/login');\n          return;\n        }\n\n        if (adminRequired && (!user || !user.isAdmin)) {\n          Router.push('/customer/my-books', '/my-books');\n        }\n\n        if (logoutRequired && user) {\n          Router.push('/');\n        }\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var user = this.props.user;\n\n        if (loginRequired && !logoutRequired && !user) {\n          return null;\n        }\n\n        if (adminRequired && (!user || !user.isAdmin)) {\n          return null;\n        }\n\n        if (logoutRequired && user) {\n          return null;\n        }\n\n        if (!user) return __jsx(BaseComponent, _extends({}, this.props, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 25\n          }\n        }));\n        if (user !== null && user !== void 0 && user.isAdmin || (user === null || user === void 0 ? void 0 : user.role) === 'admin') return __jsx(React.Fragment, null, __jsx(AdminSidebarComp, {\n          user: user,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 13\n          }\n        }, __jsx(BaseComponent, _extends({}, this.props, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 15\n          }\n        }))));\n        return __jsx(React.Fragment, null, __jsx(StudentSidebarComp, {\n          user: user,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 11\n          }\n        }, __jsx(BaseComponent, _extends({}, this.props, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 13\n          }\n        }))));\n      }\n    }], [{\n      key: \"getInitialProps\",\n      value: function () {\n        var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx) {\n          var isFromServer, user, props;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  isFromServer = false;\n                  user = ctx.req ? ctx.req.user && ctx.req.user : globalUser;\n\n                  if (isFromServer && user) {\n                    user._id = user._id.toString();\n                  }\n\n                  props = {\n                    user: user,\n                    isFromServer: isFromServer\n                  };\n\n                  if (!BaseComponent.getInitialProps) {\n                    _context.next = 14;\n                    break;\n                  }\n\n                  _context.t0 = Object;\n                  _context.t1 = props;\n                  _context.next = 9;\n                  return BaseComponent.getInitialProps(ctx);\n\n                case 9:\n                  _context.t2 = _context.sent;\n\n                  if (_context.t2) {\n                    _context.next = 12;\n                    break;\n                  }\n\n                  _context.t2 = {};\n\n                case 12:\n                  _context.t3 = _context.t2;\n\n                  _context.t0.assign.call(_context.t0, _context.t1, _context.t3);\n\n                case 14:\n                  return _context.abrupt(\"return\", props);\n\n                case 15:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function getInitialProps(_x) {\n          return _getInitialProps.apply(this, arguments);\n        }\n\n        return getInitialProps;\n      }()\n    }]);\n\n    return App;\n  }(React.Component);\n\n  var propTypes = {\n    user: PropTypes.shape({\n      id: PropTypes.string,\n      isAdmin: PropTypes.bool\n    }),\n    isFromServer: PropTypes.bool.isRequired\n  };\n  var defaultProps = {\n    user: null\n  };\n  App.propTypes = propTypes;\n  App.defaultProps = defaultProps;\n  return App;\n}","map":{"version":3,"sources":["/usr/src/kit-le-nid/lib/withAuth.jsx"],"names":["React","PropTypes","Router","NProgress","StudentSidebarComp","AdminSidebarComp","events","on","start","url","window","process","env","GA_MEASUREMENT_ID","gtag","page_path","done","globalUser","withAuth","BaseComponent","loginRequired","logoutRequired","adminRequired","App","props","user","isFromServer","push","isAdmin","role","ctx","req","_id","toString","getInitialProps","Object","assign","Component","propTypes","shape","id","string","bool","isRequired","defaultProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport Router from 'next/router';\nimport * as NProgress from 'nprogress';\nimport { StudentSidebarComp, AdminSidebarComp } from './AuthWrapper';\n\nRouter.events.on('routeChangeStart', () => {\n  NProgress.start();\n});\n\nRouter.events.on('routeChangeComplete', (url) => {\n  if (window && process.env.GA_MEASUREMENT_ID) {\n    window.gtag('config', process.env.GA_MEASUREMENT_ID, {\n      page_path: url,\n    });\n  }\n\n  NProgress.done();\n});\n\nRouter.events.on('routeChangeError', () => NProgress.done());\n\nlet globalUser = null;\n\nexport default function withAuth(\n  BaseComponent,\n  { loginRequired = true, logoutRequired = false, adminRequired = false } = {},\n) {\n  class App extends React.Component {\n    static async getInitialProps(ctx) {\n      const isFromServer = typeof window === 'undefined';\n      const user = ctx.req ? ctx.req.user && ctx.req.user : globalUser;\n\n      if (isFromServer && user) {\n        user._id = user._id.toString();\n      }\n\n      const props = { user, isFromServer };\n\n      if (BaseComponent.getInitialProps) {\n        Object.assign(props, (await BaseComponent.getInitialProps(ctx)) || {});\n      }\n\n      return props;\n    }\n\n    componentDidMount() {\n      const { user, isFromServer } = this.props;\n\n      if (isFromServer) {\n        globalUser = user;\n      }\n\n      if (loginRequired && !logoutRequired && !user) {\n        Router.push('/public/login', '/login');\n        return;\n      }\n\n      if (adminRequired && (!user || !user.isAdmin)) {\n        Router.push('/customer/my-books', '/my-books');\n      }\n\n      if (logoutRequired && user) {\n        Router.push('/');\n      }\n    }\n\n    render() {\n      const { user } = this.props;\n\n      if (loginRequired && !logoutRequired && !user) {\n        return null;\n      }\n\n      if (adminRequired && (!user || !user.isAdmin)) {\n        return null;\n      }\n\n      if (logoutRequired && user) {\n        return null;\n      }\n\n      if (!user) return <BaseComponent {...this.props} />;\n      if (user?.isAdmin || user?.role === 'admin')\n        return (\n          <>\n            <AdminSidebarComp user={user}>\n              <BaseComponent {...this.props} />\n            </AdminSidebarComp>\n          </>\n        );\n      return (\n        <>\n          <StudentSidebarComp user={user}>\n            <BaseComponent {...this.props} />\n          </StudentSidebarComp>\n        </>\n      );\n    }\n  }\n\n  const propTypes = {\n    user: PropTypes.shape({\n      id: PropTypes.string,\n      isAdmin: PropTypes.bool,\n    }),\n    isFromServer: PropTypes.bool.isRequired,\n  };\n\n  const defaultProps = {\n    user: null,\n  };\n\n  App.propTypes = propTypes;\n  App.defaultProps = defaultProps;\n\n  return App;\n}\n"]},"metadata":{},"sourceType":"module"}