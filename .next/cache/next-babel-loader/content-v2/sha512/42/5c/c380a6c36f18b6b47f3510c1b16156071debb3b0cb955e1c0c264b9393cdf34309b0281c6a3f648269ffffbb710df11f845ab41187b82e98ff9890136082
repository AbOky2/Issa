{"ast":null,"code":"var _jsxFileName = \"/usr/src/kit-le-nid/lib/withAuth.jsx\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Router from 'next/router';\nimport * as NProgress from 'nprogress';\nimport { StudentSidebarComp, AdminSidebarComp } from './AuthWrapper';\nRouter.events.on('routeChangeStart', () => {\n  NProgress.start();\n});\nRouter.events.on('routeChangeComplete', url => {\n  if (window && process.env.GA_MEASUREMENT_ID) {\n    window.gtag('config', process.env.GA_MEASUREMENT_ID, {\n      page_path: url\n    });\n  }\n\n  NProgress.done();\n});\nRouter.events.on('routeChangeError', () => NProgress.done());\nlet globalUser = null;\nexport default function withAuth(BaseComponent, {\n  loginRequired = true,\n  logoutRequired = false,\n  adminRequired = false\n} = {}) {\n  class App extends React.Component {\n    static async getInitialProps(ctx) {\n      const isFromServer = true;\n      const user = ctx.req ? ctx.req.user && ctx.req.user : globalUser;\n\n      if (isFromServer && user) {\n        user._id = user._id.toString();\n      }\n\n      const props = {\n        user,\n        isFromServer\n      };\n\n      if (BaseComponent.getInitialProps) {\n        Object.assign(props, (await BaseComponent.getInitialProps(ctx)) || {});\n      }\n\n      return props;\n    }\n\n    componentDidMount() {\n      const {\n        user,\n        isFromServer\n      } = this.props;\n\n      if (isFromServer) {\n        globalUser = user;\n      }\n\n      if (loginRequired && !logoutRequired && !user) {\n        Router.push('/public/login', '/login');\n        return;\n      }\n\n      if (adminRequired && (!user || !user.isAdmin)) {\n        Router.push('/customer/my-books', '/my-books');\n      }\n\n      if (logoutRequired && user) {\n        Router.push('/');\n      }\n    }\n\n    render() {\n      const {\n        user\n      } = this.props;\n\n      if (loginRequired && !logoutRequired && !user) {\n        return null;\n      }\n\n      if (adminRequired && (!user || !user.isAdmin)) {\n        return null;\n      }\n\n      if (logoutRequired && user) {\n        return null;\n      }\n\n      if (!user) return __jsx(BaseComponent, _extends({}, this.props, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 25\n        }\n      }));\n      if (user !== null && user !== void 0 && user.isAdmin || (user === null || user === void 0 ? void 0 : user.role) === 'admin') return __jsx(React.Fragment, null, __jsx(AdminSidebarComp, {\n        user: user,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 13\n        }\n      }, __jsx(BaseComponent, _extends({}, this.props, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 15\n        }\n      }))));\n      return __jsx(React.Fragment, null, __jsx(StudentSidebarComp, {\n        user: user,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 11\n        }\n      }, __jsx(BaseComponent, _extends({}, this.props, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 13\n        }\n      }))));\n    }\n\n  }\n\n  const propTypes = {\n    user: PropTypes.shape({\n      id: PropTypes.string,\n      isAdmin: PropTypes.bool\n    }),\n    isFromServer: PropTypes.bool.isRequired\n  };\n  const defaultProps = {\n    user: null\n  };\n  App.propTypes = propTypes;\n  App.defaultProps = defaultProps;\n  return App;\n}","map":{"version":3,"sources":["/usr/src/kit-le-nid/lib/withAuth.jsx"],"names":["React","PropTypes","Router","NProgress","StudentSidebarComp","AdminSidebarComp","events","on","start","url","window","process","env","GA_MEASUREMENT_ID","gtag","page_path","done","globalUser","withAuth","BaseComponent","loginRequired","logoutRequired","adminRequired","App","Component","getInitialProps","ctx","isFromServer","user","req","_id","toString","props","Object","assign","componentDidMount","push","isAdmin","render","role","propTypes","shape","id","string","bool","isRequired","defaultProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport Router from 'next/router';\nimport * as NProgress from 'nprogress';\nimport { StudentSidebarComp, AdminSidebarComp } from './AuthWrapper';\n\nRouter.events.on('routeChangeStart', () => {\n  NProgress.start();\n});\n\nRouter.events.on('routeChangeComplete', (url) => {\n  if (window && process.env.GA_MEASUREMENT_ID) {\n    window.gtag('config', process.env.GA_MEASUREMENT_ID, {\n      page_path: url,\n    });\n  }\n\n  NProgress.done();\n});\n\nRouter.events.on('routeChangeError', () => NProgress.done());\n\nlet globalUser = null;\n\nexport default function withAuth(\n  BaseComponent,\n  { loginRequired = true, logoutRequired = false, adminRequired = false } = {},\n) {\n  class App extends React.Component {\n    static async getInitialProps(ctx) {\n      const isFromServer = typeof window === 'undefined';\n      const user = ctx.req ? ctx.req.user && ctx.req.user : globalUser;\n\n      if (isFromServer && user) {\n        user._id = user._id.toString();\n      }\n\n      const props = { user, isFromServer };\n\n      if (BaseComponent.getInitialProps) {\n        Object.assign(props, (await BaseComponent.getInitialProps(ctx)) || {});\n      }\n\n      return props;\n    }\n\n    componentDidMount() {\n      const { user, isFromServer } = this.props;\n\n      if (isFromServer) {\n        globalUser = user;\n      }\n\n      if (loginRequired && !logoutRequired && !user) {\n        Router.push('/public/login', '/login');\n        return;\n      }\n\n      if (adminRequired && (!user || !user.isAdmin)) {\n        Router.push('/customer/my-books', '/my-books');\n      }\n\n      if (logoutRequired && user) {\n        Router.push('/');\n      }\n    }\n\n    render() {\n      const { user } = this.props;\n\n      if (loginRequired && !logoutRequired && !user) {\n        return null;\n      }\n\n      if (adminRequired && (!user || !user.isAdmin)) {\n        return null;\n      }\n\n      if (logoutRequired && user) {\n        return null;\n      }\n\n      if (!user) return <BaseComponent {...this.props} />;\n      if (user?.isAdmin || user?.role === 'admin')\n        return (\n          <>\n            <AdminSidebarComp user={user}>\n              <BaseComponent {...this.props} />\n            </AdminSidebarComp>\n          </>\n        );\n      return (\n        <>\n          <StudentSidebarComp user={user}>\n            <BaseComponent {...this.props} />\n          </StudentSidebarComp>\n        </>\n      );\n    }\n  }\n\n  const propTypes = {\n    user: PropTypes.shape({\n      id: PropTypes.string,\n      isAdmin: PropTypes.bool,\n    }),\n    isFromServer: PropTypes.bool.isRequired,\n  };\n\n  const defaultProps = {\n    user: null,\n  };\n\n  App.propTypes = propTypes;\n  App.defaultProps = defaultProps;\n\n  return App;\n}\n"]},"metadata":{},"sourceType":"module"}